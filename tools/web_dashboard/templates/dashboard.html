{% extends "base.html" %}

{% block title %}Dashboard - YMCA Data Processing{% endblock %}

{% block content %}
<div class="card">
    <h2>üöÄ Start Data Processing</h2>
    <p>Select the type of data processing you want to perform:</p>
    
    <form method="POST" action="{{ url_for('process_data') }}" style="margin-top: 1rem;">
        <div style="margin-bottom: 1rem;">
            <label for="processing_type" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Processing Type:</label>
            <select name="processing_type" id="processing_type" style="padding: 0.5rem; border-radius: 5px; border: 1px solid #ccc; min-width: 200px;">
                <option value="full">Full Processing Pipeline</option>
                <option value="pie_charts">Generate Pie Charts</option>
                <option value="line_graphs">Generate Line Graphs</option>
                <option value="bar_charts">Generate Bar Charts</option>
                <option value="scatter_plots">Generate Scatter Plots</option>
            </select>
        </div>
        <button type="submit" class="btn">Start Processing</button>
    </form>
</div>

{% if jobs %}
<div class="card">
    <h2>üìä Current Jobs</h2>
    <table class="table">
        <thead>
            <tr>
                <th>Job ID</th>
                <th>Type</th>
                <th>Status</th>
                <th>Progress</th>
                <th>Message</th>
                <th>Started</th>
            </tr>
        </thead>
        <tbody>
            {% for job_id, job in jobs.items() %}
            <tr data-job-status="{{ job.status }}" data-job-id="{{ job_id }}">
                <td>{{ job_id }}</td>
                <td>{{ job.type }}</td>
                <td><span id="status-{{ job_id }}" class="status-badge status-{{ job.status }}">{{ job.status.upper() }}</span></td>
                <td>
                    <div class="progress-bar">
                        <div id="progress-{{ job_id }}" class="progress-fill" style="width: {{ job.progress }}%;"></div>
                    </div>
                    {{ job.progress }}%
                </td>
                <td id="message-{{ job_id }}">{{ job.message }}</td>
                <td>{{ job.started_at[:19] if job.started_at else 'N/A' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<div class="card">
    <h2>üìÅ Processed Files</h2>
    {% if processed_files %}
        <div class="file-grid">
            {% for file in processed_files %}
            <div class="file-item">
                <h4>{{ file.name }}</h4>
                <p><strong>Path:</strong> {{ file.path }}</p>
                <p><strong>Size:</strong> {{ "%.2f"|format(file.size / 1024) }} KB</p>
                <p><strong>Modified:</strong> {{ file.modified[:19] }}</p>
                <a href="{{ url_for('download_file', filename=file.path) }}" class="btn btn-secondary">Download</a>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No processed files found. Start data processing to generate files.</p>
    {% endif %}
</div>

<div class="card">
    <h2>üìà Recent Reports</h2>
    {% if reports %}
        <div class="file-grid">
            {% for report in reports[:6] %}
            <div class="file-item">
                <h4>{{ report.name }}</h4>
                <p><strong>Type:</strong> {{ report.type.upper() }}</p>
                <p><strong>Size:</strong> {{ "%.2f"|format(report.size / 1024) }} KB</p>
                <p><strong>Modified:</strong> {{ report.modified[:19] }}</p>
                <a href="{{ url_for('download_file', filename=report.name) }}" class="btn btn-secondary">Download</a>
            </div>
            {% endfor %}
        </div>
        {% if reports|length > 6 %}
        <div style="text-align: center; margin-top: 1rem;">
            <a href="{{ url_for('reports_page') }}" class="btn">View All Reports</a>
        </div>
        {% endif %}
    {% else %}
        <p>No reports found. Start data processing to generate reports.</p>
    {% endif %}
</div>

<div class="card">
    <h2>‚ÑπÔ∏è System Information</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
        <div>
            <h4>Available Processing Types</h4>
            <ul>
                <li>Full Processing Pipeline</li>
                <li>Pie Charts Generation</li>
                <li>Line Graphs Generation</li>
                <li>Bar Charts Generation</li>
                <li>Scatter Plots Generation</li>
            </ul>
        </div>
        <div>
            <h4>Data Directories</h4>
            <ul>
                <li>Raw Data: data/raw/</li>
                <li>Processed Data: data/processed/</li>
                <li>Charts: charts/</li>
                <li>Final Charts: final_charts/</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}